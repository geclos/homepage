---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { formatDate } from '../../utils/formatDate';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title="Blog" description="Writing on product, engineering, and AI.">
  <section class="space-y-6">
    <div class="space-y-3">
      <div class="eyebrow">Blog</div>
      <h1 class="font-serif text-4xl md:text-5xl">Notes and essays</h1>
      <p class="max-w-2xl text-base text-muted">
        Writing on product strategy, engineering practice, and the systems we
        build.
      </p>
    </div>
    <div class="divider"></div>
  </section>

  <section class="divide-y divide-line border-y border-line">
    {posts.map((post) => {
      const slug = post.data.slug ?? post.slug;
      return (
        <article class="grid gap-6 py-8 md:grid-cols-[1fr_2.3fr]">
          <div class="space-y-3 text-xs uppercase tracking-[0.18em] text-muted">
            <span>{formatDate(post.data.date)}</span>
            {post.data.tags?.length ? (
              <div class="flex flex-wrap gap-2">
                {post.data.tags.map((tag) => (
                  <span class="border border-line px-2 py-1">{tag}</span>
                ))}
              </div>
            ) : null}
          </div>
          <div class="space-y-3">
            <h2 class="font-serif text-2xl leading-snug">
              <a href={`/blog/${slug}`} class="no-underline">
                {post.data.title}
              </a>
            </h2>
            {post.data.description && (
              <p class="text-base text-muted">{post.data.description}</p>
            )}
          </div>
        </article>
      );
    })}
  </section>
</BaseLayout>
