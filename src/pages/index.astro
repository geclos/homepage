---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { formatDate } from '../utils/formatDate';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<BaseLayout title="Gerard Clos" description="Personal website and blog.">
  <section class="mx-auto max-w-3xl pt-10 md:pt-14">
    <div class="space-y-10">
      <p class="max-w-2xl text-base leading-relaxed text-muted md:text-lg">
        Hi, I am Gerard, CTO at Latitude. I write about product, engineering,
        and the ways AI is changing how we build.
      </p>

      <div class="space-y-4">
        <div class="eyebrow">Latest posts</div>
        <div class="space-y-2">
          {posts.map((post) => {
            const frontmatterSlug =
              typeof post.data.slug === 'string' && post.data.slug.trim()
                ? post.data.slug.trim()
                : undefined;
            const slug = frontmatterSlug ?? post.slug;

            return (
              <a
                href={`/blog/${slug}`}
                class="group flex items-baseline justify-between gap-6 no-underline"
              >
                <span class="font-serif text-xl leading-snug group-hover:text-accent">
                  {post.data.title}
                </span>
                <span class="shrink-0 text-xs uppercase tracking-[0.18em] text-muted">
                  {formatDate(post.data.date)}
                </span>
              </a>
            );
          })}
        </div>

        <div class="pt-2">
          <a href="/blog" class="text-sm no-underline">
            See more
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
